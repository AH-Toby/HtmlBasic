# DOM进阶(二)

## 一、更改this指向

call与apply这两个方法都是函数天生可以调用的方法，它们的作用是执行函数并改变函数的上下文对象(this)

正常情况下：谁调用函数，函数的this指向谁

**call：**

该方法用于执行函数并改变函数的作用域。

该方法接收多个参数

第一个参数：要改变的this的指向

从第二个参数开始都是原函数所需要的参数

**apply：**

该方法也是执行函数并改变函数的作用域，它与call方法之间的区别是参数的区别。

该方法接收两个参数

第一个参数：要改变的this的指向

第二个参数：数组，数组中每一项都是传递的参数

## 二、DOM事件

### 2.1.事件流程

整个事件流程分为捕获和冒泡：

**捕获：**

事件从最顶层元素开始执行，一层一层往下执行，直到最精确的元素

**冒泡：** 

事件从最精确的元素开始执行，一层一层往上执行，直到最顶层的元素

当一个元素是触发事件的元素的时候，是不区分捕获和冒泡的

> 注意：
>
> 之前学习的事件绑定，属于DOM0级事件绑定。
>
> DOM0级事件绑定中，是在事件冒泡阶段执行的。

完整流程：事件捕获到元素，触发事件，事件冒泡到最顶层元素。

### 2.2.DOM2级事件绑定方式

**事件名称：** addEventListener

每一个元素都可以使用的方法(像window等对象也可以使用)

**使用方式：** 

```js
dom.addEventListener(type,fn,bool)
```

**type：** 事件的类型

> 注意：
>
> 不带on的事件类型。例如：click、mousedown、mouseup

**fn：** 执行函数

**bool：** 它是一个布尔值，表示是否在捕获阶段绑定

默认值时false，表示绑定到冒泡阶段，如果时true表示绑定到捕获阶段

> 注意：
>
> 为了让各级别的事件绑定执行顺序同一，我们常常将事件绑定到冒泡阶段

### 2.3.IE中的高级绑定方式

IE中是不支持addEventListener方法，支持自己的attachEvent绑定事件方式

**使用方式：**

```js
dom.attachEvent(type,fn)
```

**type：** 事件的类型

> 注意：
>
> 带on的事件类型。例如：onclick、onmousedown、onmouseup

**fn：** 执行函数

没有第三个参数，也就是说不支持捕获

### 2.4.DOM2级与DOM0级绑定区别

**绑定数量：**

dom0级事件：只能够给一个元素的一个事件绑定一个函数

dom2级事件：能够给一个元素的一个事件绑定多个函数

**执行顺序：**

是按照代码绑定顺序执行

**是否可以同时存在：**

DOM2级可以，不受DOM0级影响

**this指向：**

无论存储在哪里始终都指向触发事件的元素

### 2.5.IE与DOM0级对比

**绑定数量：**

dom0级事件：只能够给一个元素的一个事件绑定一个函数

attachEvent事件：可以给一个元素的一个事件绑定多个事件

**执行顺序：**

优先执行dom0级，然后再**逆序**执行attachEvent事件

**是否可以同时存在：**

attachEvent可以

**this指向：**

dom0级：触发事件的对象。attachEvent：指向windows

### 2.6.DMO2级事件移除

**事件移除方式：** 

使用removeEventListener方法，用于移除addEventListener绑定的事件

**使用方式：**

```js
dom.removeEventListener(type,fn,bool)
```

**type:** 要移除的事件类型

**fn:** 执行函数，移除的函数

**bool:** 决定移除哪个阶段的事件函数

> **总结**：
>
> 1.匿名函数无法移除，因此为了能过顺利移除，要为回调函数起名字
>
> 2.当绑定多个事件的时候，移除的事件对其他事件没有影响
>
> 3.在哪个阶段绑定就要在哪个阶段移除
>
> 4.removeEventListener不能移除dom0级事件，dom0级事件是通过元素的属性绑定的,因此删除该属性就可以取消绑定
>
> 5.相同事件回调函数多次绑定，会共存，删除的时候要删除多次

### 2.7.IE中的移除事件方式

**事件移除方式：**

使用detachEvent方法，用于移除attachEvent绑定的事件

**使用方式：**

```js
dom.detachEvent(type,fn)
```

**type:** 要移除的事件类型

**fn:** 执行函数，移除的函数

**总结**：

> 1.匿名函数无法移除，因此为了能过顺利移除，要为回调函数起名字
>
> 2.当绑定多个事件的时候，移除的事件对其他事件没有影响
>
> 3.detachEvent不能移除dom0级事件，dom0级事件是通过元素的属性绑定的,因此删除该属性就可以取消绑定
>
> 4.相同事件回调函数多次绑定，会共存，删除的时候要删除多次

### 2.8.事件对象

当事件执行的时候，会产生一系列的信息，这些信息会被浏览器收集起来，封装成对象传递到事件函数中。

常见属性：

**offsetX，offsetY：** 这两个属性标记的是鼠标位于元素内部的位置，会受到子元素的影响

**clientX，clientY：** 这个两个属性标记的是鼠标位于视口中的位置（x,y等价）

**pageX，pageY：** 这两个属性标记的是鼠标位于页面中的距离（layerX,layerY等价）

>  默认情况下，当打开页面时处于首屏，所以这两个属性和clientX，clientY是相同的，当页面出现滚动条的时候并改变滚动条的位置，此时这些值才会产生差异

**screenX，screenY：** 这两个属性标记了鼠标位于屏幕中的位置

### 2.9.IE中的事件对象

在DOM0级事件中，IE中并没有将事件对象传递到事件函数中

事件存储在window上，获取：window.event

**兼容方式：**

```js
var e = e||window.event
```

由于在IE中无限显示内部结构，所以我们要使用for in 循环内部结构

### 2.10.事件总结

**dom0级事件：**

在高级浏览器中可以将事件对象传递进来

IE中不能将事件对象传递进来

this指向是触发事件的对象

**dom2级事件：**

可以将事件对象传递到事件函数中

this指向是触发事件的对象

执行事件的顺序是代码的绑定顺序

**attachEvent事件：**

可以将事件对象传递到事件函数中

this指向window

执行顺序：优先执行dom0级事件，逆序执行attachEvent事件

### 2.11.阻止冒泡

**在高级浏览器中阻止冒泡的方式：**

```js
e.stopPropagation();
```

**在IE中阻止冒泡的方式：**

```js
e.cancelBubble = true; 
```

### 2.12.阻止默认行为

一些标签在点击的时候会触发一些默认行为、事件

比如：

submit：默认提交表单

a标签：如果有href属性，会默认跳转页面

当页面中出现滚动条的时候，此时，滚动鼠标滚轮的时候，会默认改变滚动条的位置，这些都是默认事件、行为

**在高级浏览器中阻止默认事件的方式：**

```js
e.preventDefault();
```

**在IE中阻止默认行为的方式：**

```js
e.returnValue = false;
```

如果使用的是dom0级事件绑定方式，还可以使用return false;

### 2.13.事件对象其他常用属性

**type:** 获取事件的类型

**target:** 返回触发此事件的元素（事件的目标节点，IE:srcElement）

**currentTarget:** 返回其事件监听器触发该事件的元素

**timeStamp:** 返回事件生成的日期和时间
